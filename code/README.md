# ポケコン改造用 ESP32 コード

ESP32 で以下のことを行うコードです。非常に荒っぽい、汚いコードですのでご了承ください。

### ターミナルモード（Raspberry Pi 起動時）
<img width="500" src="https://github.com/user-attachments/assets/9773236f-2edd-45e8-acf0-9e249d49d508">

* UART で Raspberry Pi と通信
* 全キーのスキャン（押下状態を取得）
  - 一部については文字コードを生成
  - shift (主に記号入力), caps (大文字入力), ctrl (BASICキー), ESC (カナキー)
* VT100サブセットの ANSI エスケープシーケンス処理
  - 必要最低限のコードのみ処理しています
    - 非対応のコードのため、emacs 等では時々表示がずれることがあります
  - 漢字表示(UTF-8)対応
    - 簡易処理のため、文字欠け等が生じることがあります
    - 表示文字数を減らさないため、漢字は上下に少し文字同士の重なりが生じます
  - カラー・反転等には対応していません
  - 42列7行表示
    - CLS ボタンを押すと `stty rows 7 cols 41; clear` のように画面サイズをセットするコマンドが自動入力されます
  - 履歴表示（上へのスクロール）
    - CONSTキー：上へスクロール　ANSキー : 下へスクロール
    - どれかのキーを押すと最下行へ復帰

### RPN 関数電卓モード（ESP32 単体動作時）
<img width="500" src="https://github.com/user-attachments/assets/ae766770-252a-4725-836f-81186ca1cf08">

* スタック32段、表示5段のRPN関数電卓（三角関数、対数・指数関数など）
* 32段階のアンドゥ機能
* フルキーのアルファベットを用いた機能
  - A-F でスタックの深い位置にある値を取り出し可能
  - X-Z のメモリ機能（shift-X で保存、X で呼び出し）

### なお、Raspberry Pi Zero 2W 側はプログラミング不要です。

* [設定画面（GUI の「設定」、または CLI の raspi-config）で、シリアルポート有効、シリアルコンソール有効にセット](https://toki-blog.com/pi-serial/)してください。GPIO14/15 (TXD/RXD) からシリアル通信でログインできるようになります（起動時・シャットダウン時のメッセージも表示されます）。
